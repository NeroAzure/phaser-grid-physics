!function(i,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("GridPhysics",[],t):"object"==typeof exports?exports.GridPhysics=t():i.GridPhysics=t()}(window,function(){return function(i){var t={};function e(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return i[o].call(r.exports,r,r.exports,e),r.l=!0,r.exports}return e.m=i,e.c=t,e.d=function(i,t,o){e.o(i,t)||Object.defineProperty(i,t,{configurable:!1,enumerable:!0,get:o})},e.r=function(i){Object.defineProperty(i,"__esModule",{value:!0})},e.n=function(i){var t=i&&i.__esModule?function(){return i.default}:function(){return i};return e.d(t,"a",t),t},e.o=function(i,t){return Object.prototype.hasOwnProperty.call(i,t)},e.p="",e(e.s=3)}([function(i,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function i(i,t){for(var e=0;e<t.length;e++){var o=t[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(i,o.key,o)}}return function(t,e,o){return e&&i(t.prototype,e),o&&i(t,o),t}}();var r=function(){function i(){!function(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.tilemaps=[],this.world=Phaser.Physics.GridPhysics.world}return o(i,[{key:"collide",value:function(i){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.world.tilemaplayers,arguments.length>4&&void 0!==arguments[4]&&arguments[4]),r=void 0,s=void 0,l=void 0,n=void 0,h=void 0,a=void 0,d=void 0;if(i.hasOwnProperty("body")?(r={x:i.body.gridPosition.x,y:i.body.gridPosition.y},s=i.body.width,l=i.body.height,n=i.body.collideWorldBounds,a=i.body.level,d=i.body.collisionCallback.tile):(r={x:i.x,y:i.y},s=i.width?i.width:1,l=i.height?i.height:1,n=!!i.hasOwnProperty("collideWorldBounds")&&i.collideWorldBounds,h=!0,a=i.level?i.level:0,d=i.collisionCallback),n&&(r.x+t<0||r.y+e<0||r.x+t+s>this.world.tilemaplayers[0].width/this.world.gridSize.x||r.y+e+l>this.world.tilemaplayers[0].height/this.world.gridSize.y))return!0;r.x+=t,r.y+=e,0!==t?(t>0&&(r.x+=s-1),s=1):0!==e&&(e>0&&(r.y+=l-1),l=1);for(var c=r.x;c<r.x+s;c++)for(var u=r.y;u<r.y+l;u++){var y=!1,g=!0,f=!1,v=void 0;try{for(var p,x=this.world.tilemaplayers[Symbol.iterator]();!(g=(p=x.next()).done);g=!0){var w=p.value;if(!(a>w.level)){var b=w.layer.baseTileHeight,P=w.layer.baseTileHeight,m=Math.floor(u*this.world.gridSize.y/b),S=void 0;if(m<0||m>w.layer.data.length-1){if(this.collideWorldBounds)return!0}else if((S=Math.floor(c*this.world.gridSize.x/P))<0||m>w.layer.data[m].length-1){if(this.collideWorldBounds)return!0}else{var k=w.layer.data[m][S]||null;if(k&&-1===k.index&&w.level>0&&a>0)return console.log(w.level),!0;if(h&&console.log(k,S,m),null!==k&&(-1!==k.index||k.gotBorder)){var T=d?d(k):k;if(T.collideRight&&T.collideLeft&&T.collideDown&&T.collideUp){y=!0;break}if(t<0&&T.collideRight){y=!0;break}if(t>0&&T.collideLeft){y=!0;break}if(e<0&&T.collideDown){y=!0;break}if(e>0&&T.collideUp){y=!0;break}}}}}}catch(i){f=!0,v=i}finally{try{!g&&x.return&&x.return()}finally{if(f)throw v}}if(y){if(o){if(0!==t){if(!this.collide(i,t,e-1))return{dx:t,dy:e-1};if(!this.collide(i,t,e+1))return{dx:t,dy:e+1}}if(0!==e){if(!this.collide(i,t-1,e))return{dx:t-1,dy:e};if(!this.collide(i,t+1,e))return{dx:t+1,dy:e}}}return{dx:0,dy:0}}}return!1}},{key:"getTilesUnderBody",value:function(i){return this.getTilesAt(i.gridPosition.x,i.gridPosition.y,i.width,i.height)}},{key:"getTilesAt",value:function(i,t,e,o){var r=[];return this.world.tilemaplayers.forEach(function(s,l){r[l]=[];for(var n=i;n<i+e;n+=2)for(var h=t;h<t+o;h+=2){var a=s.layer.data[h][n]||null;r[l].push(a)}}),r}},{key:"checkLevel",value:function(i,t,e){var o=void 0,r=void 0,s=void 0,l=0;i.hasOwnProperty("body")?(o={x:i.body.gridPosition.x,y:i.body.gridPosition.y},r=i.body.width,s=i.body.height):(o={x:i.x,y:i.y},r=i.width?i.width:1,s=i.height?i.height:1),o.x+=t,o.y+=e,0!==t?r=1:s=1,t>0?o.x=o.x+r:e>0&&(o.y=o.y+s);for(var n=o.x;n<o.x+r;n++)for(var h=o.y;h<o.y+s;h++){var a=!0,d=!1,c=void 0;try{for(var u,y=this.world.tilemaplayers[Symbol.iterator]();!(a=(u=y.next()).done);a=!0){var g=u.value,f=g.layer.data[Math.floor(h/2)][Math.floor(n/2)];console.log(g,g.level,n,h,f),f&&f.index>0&&g.level>l&&(l=g.level)}}catch(i){d=!0,c=i}finally{try{!a&&y.return&&y.return()}finally{if(d)throw c}}}return console.log("LEVEL",l),l}}]),i}();t.default=r},function(i,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function i(i,t){for(var e=0;e<t.length;e++){var o=t[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(i,o.key,o)}}return function(t,e,o){return e&&i(t.prototype,e),o&&i(t,o),t}}();var r=function(){function i(t){!function(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.sprite=t,this.world=Phaser.Physics.GridPhysics.world,this.tilemap=Phaser.Physics.GridPhysics.tilemap,this.solid=!0,this.gridPosition=new Phaser.Geom.Point(0,0),this.zIndex=0,this.zHeight=1,this.width=Math.round(t.width/this.world.gridSize.x),this.height=Math.round(t.height/this.world.gridSize.y),this.velocity=new Phaser.Geom.Point(0,0),this._desiredVelocity=new Phaser.Geom.Point(0,0),this.mass=1,this.strength=-1,this.pushLimit=-1,this.struggle=0,this.struggling=!1,this.facing=Phaser.NONE,this.immovable=!1,this.collidable=!0,this.collideWorldBounds=!1,this.isMoving={x:!1,y:!1,any:!1},this.level=0,this.moveTo={active:!1,path:[],next:null,recalc:0},this.magnetism={dragItself:!1,weakenByFactor:1,maxRange:1,top:{active:!1,power:0,pole:null,attractedTo:null,attractedToAll:!1},right:{active:!1,power:0,pole:null,attractedTo:null,attractedToAll:!1},bottom:{active:!1,power:0,pole:null,attractedTo:null,attractedToAll:!1},left:{active:!1,power:0,pole:null,attractedTo:null,attractedToAll:!1}},this.cojoinedBodies=[],this.collidingBodies=[],this.collectCollidingBodies=!0,this._shadow=new Phaser.Geom.Point(0,0),this.isLocked={x:!1,y:!1,any:!1},this._longPress=0,this.activeSteps=0,this.passiveSteps=0,this.collisionCallback={tile:null,body:null},this.myTurn=!1,this.turns=0,this.reload=1,this.onStairs=!1,this.sprite.setOrigin(0,0),this.snapToGrid()}return o(i,[{key:"snapToGrid",value:function(){this.gridPosition={x:Math.round(this.sprite.x/this.world.gridSize.x),y:Math.round(this.sprite.y/this.world.gridSize.y)},this.sprite.x=this.world.gridSize.x*this.gridPosition.x,this.sprite.y=this.world.gridSize.y*this.gridPosition.y}},{key:"setPosition",value:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.gridPosition.x=i,this.gridPosition.y=t,this.sprite.x=this.world.gridSize.x*this.gridPosition.x,this.sprite.y=this.world.gridSize.y*this.gridPosition.y,this.isLocked.x=!1,this.isLocked.y=!1}},{key:"setVelocity",value:function(i){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t=null!==t?t:i,0===i&&0!==t?this._longpress=1:0===t&&0!==i&&(this._longpress=0),this._desiredVelocity={x:i,y:t}}},{key:"_intersectRect",value:function(i,t){return!(t.x>=i.x+i.width||t.x+t.width<=i.x||t.y>=i.y+i.height||t.y+t.height<=i.y)}},{key:"getTilesUnderBody",value:function(){return this.tilemap.getTilesUnderBody(this)}},{key:"testMove",value:function(i,t){var e=!0;if(!this.collidable)return!0;if(this.onStairs&&(this.level=this.tilemap.checkLevel(this.sprite,i,t)),this.tilemap.collide(this.sprite,i,t)&&this.solid)return!1;if(!this.collectCollidingBodies&&!e)return!1;var o=!0,r=!1,s=void 0;try{for(var l,n=this.world.bodies[Symbol.iterator]();!(o=(l=n.next()).done);o=!0){var h=l.value,a=this.collisionCallback.body?this.collisionCallback.body(h,this):h.solid;if(this!==h&&h.collidable&&(h.level===this.level||h.onStairs)){if(!e&&!this.collectCollidingBodies&&!h.collectCollidingBodies)continue;if(this._intersectRect({x:this.gridPosition.x+i,y:this.gridPosition.y+t,width:this.width,height:this.height},{x:h.gridPosition.x,y:h.gridPosition.y,width:h.width,height:h.height})){if(this.collectCollidingBodies&&-1===this.collidingBodies.indexOf(h)&&this.collidingBodies.push(h),h.collectCollidingBodies&&-1===h.collidingBodies.indexOf(this)&&h.collidingBodies.push(this),!this.solid||!a)continue;h.immovable?e=!1:-1===this.world._pushChain.indexOf(h)&&(this.world._pushChain.push(h),h.testMove(i,t)||(e=!1))}}}}catch(i){r=!0,s=i}finally{try{!o&&n.return&&n.return()}finally{if(r)throw s}}return e}},{key:"postUpdate",value:function(){if(this.collidingBodies=[],this.justMoved=!1,!this.isLocked.x&&!this.isLocked.y){if(this.moveTo.active){this._desiredVelocity={x:0,y:0};var i=this.moveTo.path[this.moveTo.next];i.x<this.gridPosition.x?this._desiredVelocity.x=-100:i.x>this.gridPosition.x?this._desiredVelocity.x=100:i.y<this.gridPosition.y?this._desiredVelocity.y=-100:i.y>this.gridPosition.y&&(this._desiredVelocity.y=100),this.moveTo.next++,this.moveTo.next>this.moveTo.path.length-1&&(this.moveTo.active=!1)}if(this.isMoving={x:!1,y:!1,any:!1},0===this._desiredVelocity.x&&0===this._desiredVelocity.y)return this.velocity.x=0,this.velocity.y=0,void(this.struggling=!1);this.world._pushChain=[];for(var t=!0,e={},o=["x","y"],r=0;r<o.length;r++){var s=o[r];e[s]=0===this._desiredVelocity[s]?0:this._desiredVelocity[s]>0?1:-1}for(var l=[0,1],n=0;n<l.length;n++){if(0===l[n]){if(0===e.x)continue;if(!this.testMove(e.x,0)){t=!1;break}t=!0}else{if(0===e.y)continue;if(!this.testMove(0,e.y)){t=!1;break}t=!0}}if(this.strength>-1||this.struggle>1){var h=0,a=!0,d=!1,c=void 0;try{for(var u,y=this.world._pushChain[Symbol.iterator]();!(a=(u=y.next()).done);a=!0){h+=u.value.mass}}catch(i){d=!0,c=i}finally{try{!a&&y.return&&y.return()}finally{if(d)throw c}}this.strength>-1&&h>this.strength&&(t=!1),this.struggle>1&&h>0&&(this._desiredVelocity.x=this._desiredVelocity.x/(h*this.struggle),this._desiredVelocity.y=this._desiredVelocity.y/(h*this.struggle))}if(this.pushLimit>-1&&this.world._pushChain.length>this.pushLimit&&(t=!1),!t)return 0===this._desiredVelocity.x&&0===this._desiredVelocity.y||(this.struggling=!0),this._desiredVelocity.x>0?this.facing=Phaser.RIGHT:this._desiredVelocity.x<0?this.facing=Phaser.LEFT:this._desiredVelocity.y<0?this.facing=Phaser.UP:this._desiredVelocity.y>0&&(this.facing=Phaser.DOWN),this.velocity.x=0,this.velocity.y=0,this._shadow.x=0,void(this._shadow.y=0);for(var g=["x","y"],f=0;f<g.length;f++){var v=g[f];if(this.velocity[v]=this._desiredVelocity[v],this._shadow[v]=0,0!=this.velocity[v]){this.gridPosition[v]+=this.velocity[v]>0?1:-1,this.isLocked[v]=!0,this._shadow[v]=this.velocity[v]<0?1:-1;var p=!0,x=!1,w=void 0;try{for(var b,P=this.world._pushChain[Symbol.iterator]();!(p=(b=P.next()).done);p=!0){var m=b.value;m.passiveSteps++,m.snapToGrid(),m.velocity[v]=this._desiredVelocity[v],m.gridPosition[v]+=m.velocity[v]>0?1:-1,m.isLocked[v]=!0,m.onStairs=this.checkStairs(m)}}catch(i){x=!0,w=i}finally{try{!p&&P.return&&P.return()}finally{if(x)throw w}}}}this.velocity.x>0?this.facing=Phaser.RIGHT:this.velocity.x<0?this.facing=Phaser.LEFT:this.velocity.y<0?this.facing=Phaser.UP:this.velocity.y>0&&(this.facing=Phaser.DOWN),0!==this.velocity.x&&(this.isMoving.x=!0),0!==this.velocity.y&&(this.isMoving.y=!0),this.isMoving.any=!0,this.struggling=!1,this.baseVelocity=75,this.activeSteps++,this.justMoved=!0;var S=this.onStairs;this.onStairs=this.checkStairs(this),S&&!this.onStairs&&(1===this.level?this.sprite.setDepth(11):this.sprite.setDepth(1))}}},{key:"checkStairs",value:function(i){var t=i.gridPosition,e=!0,o=!1,r=void 0;try{for(var s,l=this.world.stairs[Symbol.iterator]();!(e=(s=l.next()).done);e=!0){var n=s.value;if(t.x<n.x+n.width&&t.x+i.width>n.x&&t.y<n.y+n.height&&i.height+t.y>n.y)return i.sprite.setDepth(1e3),!0}}catch(i){o=!0,r=i}finally{try{!e&&l.return&&l.return()}finally{if(o)throw r}}return!1}},{key:"drawDebug",value:function(i){var t=this.gridPosition.x*this.world.gridSize.x,e=this.gridPosition.y*this.world.gridSize.y,o=this.width*this.world.gridSize.x,r=this.height*this.world.gridSize.y;i.lineStyle(1,"0xFFFFFF"),i.strokeRect(t,e,o,r)}}]),i}();t.default=r},function(i,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},s=function(){function i(i,t){for(var e=0;e<t.length;e++){var o=t[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(i,o.key,o)}}return function(t,e,o){return e&&i(t.prototype,e),o&&i(t,o),t}}(),l=e(1),n=(o=l)&&o.__esModule?o:{default:o};var h=function(){function i(t,e){!function(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.cnt=0,this.scene=t,this.gridSize=new Phaser.Geom.Point(e.gridSize.x,e.gridSize.y),this.shadowSize=0,this.lockBodies=!1,this.bodies=[],this.tilemaplayers=[],this.tileGridRatio=new Phaser.Geom.Point(-1,-1),this._pushChain=[],this.stairs=[],this.map=null,this.debugGfx={graphics:null,update:!0,grid:{active:!1,wasActive:!1,data:null},path:{active:!1,wasActive:!1,data:null},pathCollision:{active:!1,wasActive:!1},collision:{active:!1,wasActive:!1,data:null}},window.debugGfx=this.debugGfx,this.turnbased=!1,this.turn=0,this.que=[],this.firstInLine=null,this.collisionMap=null,this.showWarnings=!0,this.drawDebug=!!e.debug&&this.createDebugGraphic()}return s(i,[{key:"enable",value:function(i){switch(i.type){case"Sprite":i.body=new n.default(i),this.bodies.push(i.body);break;case"DynamicTilemapLayer":case"StaticTilemapLayer":return(this.showWarnings&&i.collisionWidth%this.gridSize.x!=0||i.collisionWidth%this.gridSize.x!=0)&&console.warn("Tile size isn't an even multiplier of the grid size. This will probably break your game."),this.tilemaplayers.push(i),i.level=i.level?i.level:0,i.setOrigin(0,0),-1===this.tileGridRatio.x&&this.tileGridRatio.setTo(i.collisionWidth/this.gridSize.x,i.collisionHeight/this.gridSize.y),void this.updateBorders(i);default:i.hasOwnProperty&&(this.map=i)}}},{key:"updateBorders",value:function(i){for(var t=i.layer.data,e=0;e<t.length;e++)for(var o=0;o<t[e].length;o++){var r=t[e][o];r.borderUp&&(r.collideUp=!0,t[e-1][o].collideDown=!0,t[e-1][o].gotBorder=!0),r.borderDown&&(r.collideDown=!0,t[e+1][o].collideUp=!0,t[e+1][o].gotBorder=!0),r.borderLeft&&(r.collideLeft=!0,t[e][o-1].collideRight=!0,t[e][o-1].gotBorder=!0),r.borderRight&&(r.collideRight=!0,t[e][o+1].collideLeft=!0,t[e][o+1].gotBorder=!0)}}},{key:"addToQue",value:function(i){var t=this,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!i.hasOwnProperty("myTurn"))if(i.hasOwnProperty("body"))i=i.body;else{if("object"===(void 0===i?"undefined":r(i))&&i.length>0)return void i.forEach(function(i){t.addToQue(i,e)});console.error("You need to pass a sprite with gridBody, gridBody or an array to addToQue.")}if(this.firstInLine=this.firstInLine?this.firstInLine:i.sprite,this.firstInLine.body.myTurn=!0,0===e&&(e=i.reload>0?i.reload:1),this.que.length<2*e)for(var o=0;o<2*e;o++)this.que.push(null);for(var s=2*e;null!=this.que[s];)s++;for(this.que.splice(s,0,i);null===this.que[0]&&this.que.length>0;)this.que.shift(0)}},{key:"nextTurn",value:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=null;for(this.addToQue(this.firstInLine,i),this.firstInLine.body.myTurn=!1,this.firstInLine.body.turn++,this.turn++,this.que.shift(0);null===this.que[0]&&this.que.length>0;)this.que.shift(0);0!==this.que.length?((t=this.que[0]).myTurn=!0,this.firstInLine=t.sprite):console.error("EMPTY QUE!")}},{key:"update",value:function(i,t){this.turnMade=!1;var e=t/1e3,o=!0,r=!1,s=void 0;try{for(var l,n=this.bodies[Symbol.iterator]();!(o=(l=n.next()).done);o=!0)for(var h=l.value,a={x:h.sprite.x,y:h.sprite.y},d=["x","y"],c=0;c<d.length;c++){var u=d[c];0!==h.velocity[u]?(h.gridPosition[u]*h.world.gridSize[u]!=h.sprite[u]&&(h.sprite[u]+=h.velocity[u]*e,a[u]=h.sprite[u]+h.velocity[u]*e),h.velocity[u]>0&&a[u]>h.gridPosition[u]*h.world.gridSize[u]&&(h.isLocked[u]=!1),h.velocity[u]<0&&a[u]<h.gridPosition[u]*h.world.gridSize[u]&&(h.isLocked[u]=!1),h.isLocked.x||h.isLocked.y||!this.turnbased||h.setVelocity(0)):h.sprite[u]=h.gridPosition[u]*h.world.gridSize[u]}}catch(i){r=!0,s=i}finally{try{!o&&n.return&&n.return()}finally{if(r)throw s}}if(this.drawDebug){var y=this.debugGraphic;y.clear(),this.bodies.forEach(function(i){i.drawDebug(y)})}}},{key:"renderDebug",value:function(){var i=this.debugGfx;if(i.grid.active!=i.grid.wasActive||i.path.active!=i.path.wasActive||i.pathCollision.active!=i.pathCollision.wasActive||i.collision.active!=i.collision.wasActive){i.graphics?i.graphics.clear():i.graphics=game.add.graphics(0,0),i.grid.active&&this.renderGrid(),i.path.active&&this.renderPath(),i.pathCollision.active&&this.renderPathCollision(),i.collision.active&&this.renderCollision();for(var t=["grid","collision","path","pathCollision"],e=0;e<t.length;e++){var o=t[e];i[o].wasActive=i[o].active}i.grid.active||i.path.active||i.pathCollision.active||i.collision.active?i.graphics.alpha=1:i.graphics.alpha=0}}},{key:"renderGrid",value:function(){var i=this.debugGfx.graphics;i.lineStyle(1,0,.2);for(var t=0;t<this.game.width/this.gridSize.x;t++)i.moveTo(t*this.gridSize.x,0),i.lineTo(t*this.gridSize.x,this.game.height);for(var e=0;e<this.game.height/this.gridSize.y;e++)i.moveTo(0,e*this.gridSize.y),i.lineTo(this.game.width,e*this.gridSize.y)}},{key:"renderCollision",value:function(){var i=this.debugGfx.graphics;i.lineStyle(0,65280,0);var t=!0,e=!1,o=void 0;try{for(var r,s=this.tilemaplayers[Symbol.iterator]();!(t=(r=s.next()).done);t=!0){var l=r.value;for(var n in l.layer.data)for(var h in l.layer.data[n]){var a=l.layer.data[n][h];a.collides&&(i.beginFill(16711680,.5),i.drawRect(h*a.width+1,n*a.height+1,a.width-2,a.height-2),i.endFill())}}}catch(i){e=!0,o=i}finally{try{!t&&s.return&&s.return()}finally{if(e)throw o}}}},{key:"renderPathCollision",value:function(i){if(i)return this.debugGfx.pathCollision.data=i,void(this.debugGfx.pathCollision.wasActive=!1);if(this.debugGfx.pathCollision.data&&0!==this.debugGfx.pathCollision.data.length)for(var t=this.debugGfx.graphics,e=this.debugGfx.pathCollision.data,o=0;o<e.length;o++){t.lineStyle(1,16711680,.3);for(var r=0;r<e[0].length;r++)0!=e[o][r]&&(e[o][r]<2?t.beginFill(16724736,.4):4==e[o][r]?t.beginFill(255,.4):t.beginFill(16724991,.4),t.drawRect(r*this.gridSize.x,o*this.gridSize.y,this.gridSize.x,this.gridSize.y),t.endFill())}}},{key:"renderPath",value:function(i){if(i)return this.debugGfx.path.data=i,void(this.debugGfx.path.wasActive=!1);if(this.debugGfx.path.data&&0!==this.debugGfx.path.data.length){var t=this.debugGfx.graphics,e=this.debugGfx.path.data;t.lineStyle(1,65280,.5);var o=!0,r=!1,s=void 0;try{for(var l,n=e[Symbol.iterator]();!(o=(l=n.next()).done);o=!0){var h=l.value;t.beginFill(65280,.4),t.drawRect(h.x*this.gridSize.x,h.y*this.gridSize.y,this.gridSize.x,this.gridSize.y)}}catch(i){r=!0,s=i}finally{try{!o&&n.return&&n.return()}finally{if(r)throw s}}var a=e[e.length-1];t.beginFill(16724736,.7),t.drawRect(a.x*this.gridSize.x,a.y*this.gridSize.y,this.gridSize.x,this.gridSize.y),t.endFill()}}},{key:"resetCollisionLayer",value:function(){for(var i=this.map,t=i.getLayerIndex("gridPhysicsCollision"),e=void 0,o=0;o<i.layers[t].width;o++)for(var r=0;r<i.layers[t].height;r++)i.putTileAt(1,o,r,"gridPhysicsCollision"),(e=i.getTileAt(o,r,"gridPhysicsCollision")).collideUp=!1,e.collideRight=!1,e.collideDown=!1,e.collideLeft=!1}},{key:"addToLayerToCollision",value:function(i){console.log("WHAT");var t=i.tilemap;i.collisionWidth=t.tileWidth,i.collisionHeight=t.tileHeight,console.log(i.collisionHeigh,t,i);var e=t.getLayerIndex("gridPhysicsCollision");console.log("COL",i);var o=void 0,r=void 0;if(r=t.getTileAt(1,0,i),console.log("tile",r.index),!e){var s=t.createBlankDynamicLayer("gridPhysicsCollision",t.width,t.height,t.tileWidth,t.tileHeight);e=t.getLayerIndex("gridPhysicsCollision"),s.visible=!1,this.resetCollisionLayer()}console.log(t),r=t.getTileAt(1,0,i),console.log("tile",r.index),console.log("layerindex",i.layerIndex),console.log("asa",i);for(var l=0;l<i.width;l++){console.log(l);for(var n=0;n<i.height;n++){var h=t.getTileAt(l,n,i);null!==h&&(21!==h.index?console.log(h):console.log("."),(o=t.getTileAt(l,n,"gridPhysicsCollision")).collideUp=!!h.collideUp||o.collideUp,o.collideRight=!!h.collideRight||o.collideRight,o.collideDown=!!h.collideDown||o.collideDown,o.collideLeft=!!h.collideLeft||o.collideLeft)}}console.log(t.layers[e])}},{key:"setLayerLevel",value:function(i,t){i.level=t}},{key:"addStairs",value:function(i){this.stairs.push({x:i.x/this.gridSize.x,y:i.y/this.gridSize.y-2,width:i.width/this.gridSize.x,height:i.height/this.gridSize.y})}},{key:"createDebugGraphic",value:function(){var i=this.scene.sys.add.graphics({x:0,y:0});return i.setDepth(Number.MAX_VALUE),this.debugGraphic=i,!0}}]),i}();t.default=h},function(i,t,e){"use strict";var o=function(){function i(i,t){for(var e=0;e<t.length;e++){var o=t[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(i,o.key,o)}}return function(t,e,o){return e&&i(t.prototype,e),o&&i(t,o),t}}(),r=l(e(2)),s=l(e(0));function l(i){return i&&i.__esModule?i:{default:i}}var n=function(i){function t(i,e){!function(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?i:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i,e)),l=i.registry.parent.config.physics.grid;if(i.registry.parent.config.physics.grid){var n=l.gridSize;n||(n={x:8,y:8}),"number"==typeof n?n={x:n,y:n}:n.hasOwnProperty("x")&&n.hasOwnProperty("y")||(n={x:8,y:8}),l={debug:!!l.debug,gridSize:n}}return Phaser.Physics.GridPhysics=o,o.world=new r.default(i,l),o.tilemap=new s.default,i.gridPhysics=o,i.sys.settings.isBooted||i.sys.events.once("boot",o.boot,o),o}return function(i,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}(t,Phaser.Plugins.ScenePlugin),o(t,[{key:"boot",value:function(){var i=this.systems.events;i.on("update",this.update,this),i.on("postupdate",this.postUpdate,this),i.on("shutdown",this.shutdown,this),i.on("destroy",this.destroy,this)}},{key:"postUpdate",value:function(i,t){this.world.bodies.forEach(function(i){i.postUpdate()})}},{key:"update",value:function(i,t){this.world.update(i,t)}},{key:"shutdown",value:function(){}},{key:"destroy",value:function(){this.shutdown(),this.scene=void 0}}]),t}();n.register=function(i){i.register("GridPhysics",n,"GridPhysics")},i.exports=n}])});